# 1. Spring Batch 개요

## 배치 처리란 무엇인가

배치 처리(Batch Processing)란 **사용자와의 상호작용 없이** 대량의 데이터를 일괄적으로 처리하는 방식을 말한다.

### 배치 처리의 특징

- **대량 처리**: 수천~수억 건의 데이터를 한 번에 처리한다.
- **자동화**: 사람의 개입 없이 정해진 시점에 자동으로 실행된다.
- **비실시간**: 실시간 응답이 필요하지 않으며, 일정 주기(일/시간/분 단위)로 실행된다.
- **안정성**: 중간에 실패하더라도 실패 지점부터 재시작할 수 있어야 한다.

### 일상적인 배치 처리 사례

| 사례 | 설명 |
|------|------|
| 정산 처리 | 매일 자정에 하루치 결제 내역을 집계하여 정산 |
| 데이터 마이그레이션 | 레거시 DB에서 신규 DB로 데이터를 변환하여 이관 |
| 리포트 생성 | 일/주/월 단위로 통계 데이터를 집계하여 리포트 생성 |
| 대량 알림 발송 | 조건에 해당하는 사용자에게 이메일/푸시 일괄 발송 |
| ETL (Extract-Transform-Load) | 외부 시스템에서 데이터를 추출 → 변환 → 적재 |

---

## Spring Batch 가 해결하는 문제

배치 처리를 직접 구현하면 매번 반복적으로 해결해야 하는 공통 문제들이 있다. Spring Batch 는 이러한 문제를 프레임워크 수준에서 해결한다.

### 직접 구현 시 마주하는 문제들

1. **대량 데이터를 어떻게 나눠서 처리할 것인가?**
   - 한 번에 모든 데이터를 메모리에 올리면 OOM 이 발생한다.
   - Spring Batch 는 **Chunk 단위 처리**로 이를 해결한다.

2. **실패했을 때 어디서부터 다시 시작할 것인가?**
   - 10만 건 중 7만 건째에서 실패하면 처음부터 다시 돌려야 하는가?
   - Spring Batch 는 **JobRepository 에 실행 상태를 기록**하여 실패 지점부터 재시작을 지원한다.

3. **트랜잭션은 어떤 단위로 관리할 것인가?**
   - 100만 건을 하나의 트랜잭션으로 처리하면 롤백 비용이 크다.
   - Spring Batch 는 **Chunk 단위 트랜잭션**으로 커밋 간격을 제어한다.

4. **특정 레코드가 실패하면 전체를 중단할 것인가?**
   - Spring Batch 는 **Skip/Retry 정책**을 통해 유연하게 대응한다.

5. **실행 이력과 상태는 어떻게 관리할 것인가?**
   - Spring Batch 는 **메타데이터 테이블**(6개)로 모든 실행 이력을 자동 관리한다.

### Spring Batch 의 설계 원칙

- **표준화된 처리 패턴**: Reader → Processor → Writer 라는 일관된 구조
- **관심사 분리**: 비즈니스 로직(Processor)과 인프라(Reader/Writer)를 분리
- **선언적 구성**: Job 과 Step 을 선언적으로 구성하고 조합
- **확장 가능성**: 인터페이스 기반 설계로 커스텀 구현이 용이

---

## 전체 아키텍처 다이어그램

Spring Batch 의 전체 구조는 크게 **Application**, **Core**, **Infrastructure** 세 계층으로 나뉜다.

```
┌─────────────────────────────────────────────────────┐
│                   Application                        │
│         (개발자가 작성하는 Job, Step 구성)              │
├─────────────────────────────────────────────────────┤
│                      Core                            │
│    JobLauncher, Job, Step, Flow 등 실행 프레임워크      │
├─────────────────────────────────────────────────────┤
│                  Infrastructure                      │
│   ItemReader, ItemWriter, JobRepository 등 인프라      │
└─────────────────────────────────────────────────────┘
```

### 핵심 컴포넌트 간 관계

```
JobLauncher
    │
    ▼
   Job  ◄──────── JobRepository (실행 상태 저장/조회)
    │
    ├── Step 1
    │     ├── ItemReader    ── 데이터 읽기
    │     ├── ItemProcessor ── 데이터 가공
    │     └── ItemWriter    ── 데이터 쓰기
    │
    ├── Step 2
    │     └── Tasklet       ── 단순 작업 실행
    │
    └── Step 3
          └── ...
```

### 실행 흐름 요약

```
1. JobLauncher 가 Job 을 실행한다.
2. JobRepository 에서 이전 실행 이력을 확인한다.
3. 새로운 JobExecution 을 생성하고 저장한다.
4. Job 은 정의된 순서대로 Step 을 실행한다.
5. 각 Step 은 Chunk 단위로 Read → Process → Write 를 반복한다.
6. 각 Chunk 처리 결과는 StepExecution 에 기록된다.
7. 모든 Step 이 완료되면 JobExecution 상태를 COMPLETED 로 갱신한다.
```

---

## 다음 장에서는

핵심 도메인 모델인 **Job, JobInstance, JobExecution, Step, StepExecution** 의 관계와 각각의 역할을 자세히 살펴본다.
