# ECS

## ECS Cluster
클러스터 시작 유형
- EC2
  - EC2 인스턴스를 사용하여 컨테이너를 실행
  - EC2 인스턴스를 관리하므로 컨테이너를 실행할 수 있는 물리적인 리소스에 대한 제한이 없음
- Fargate
  - 서버리스 컨테이너 플랫폼
  - 컨테이너를 실행할 수 있는 물리적인 리소스에 대한 제한이 있음
- EC2 vs Fargate
  - 데브옵스팀에서 답변해주신 내용으로는 다음과 같다.
    - Fargate 의 장점은 확실히 serverless 닌깐 완전 관리형이라는 점
    - 하지만 Fargate 사용시 단점은 다음과 같다.
      - 시스템 명령어를 사용하지 못해 커널 및 성능 튜닝을 가져가지 못한다. (ex. sysctl 등)
      - 성능적인 측면에서 같은 CPU를 사용한다고 하더라도 EC2에 비해 떨어진다 (외부 성능 분석 자료를 토대로 파악)
      - 비용적인 측면에서 Fargete가 훨씬 더 비용이 있다.
      
## ECS 배포 방식
- 롤링 업데이트
  - 여러 개의 가동중인 서버를 갖춘 환경에서 한 번에 정해진 수만큼의 서버에 새로운 변경 사항이 포함된 애플리케이션을 배포하는 방식
  - 구 버전에서 새 버전으로 트래픽을 점진적으로 전환하며, 구 버전의 인스턴스도 점차 삭제
  - 롤링 업데이트는 배포 시간이 오래 걸리지만, 트래픽을 점진적으로 전환하기 때문에 배포 중에도 서비스를 계속 제공할 수 있음
- 블루 그린 배포 방식
  - 여러 개의 가동중인 서버를 갖춘 환경에서 새로운 변경 사항이 포함된 애플리케이션을 위한 새로운 환경을 구축하고 교체하는 방식
  - 신 버전과 구 버전의 어플리케이션이 한 순간이라도 공존
  - 블루 그린 배포 방식은 롤링 업데이트와 달리 트래픽을 한 번에 전환
  - 블루 그린 배포 방식은 롤백이 쉽다는 장점이 있음
- 롤링 업데이트 vs 블루 그린 배포 방식
  - 데브옵스팀에서 답변해주신 내용으로는 다음과 같다.
    - 안정성과 가용성 측면에서는 블루 그린 배포 방식의 장점이 있지만 복잡성과 비용 측면에서는 롤링 업데이트의 장점이 있다.
    - 서비스 규모와 서버 엔진에 따라 선택이 달리질수 있을꺼 같다.
      - jvm 기반인 경우는 서버를 띄우는데 걸리는 시간이 node보다는 훨씬더 걸리기 때문에 롤백 시간이 오래걸리는 롤링 업데이트 보다는 블루 그린 배포 방식을 채택하는 경우가 있다.
      - 대규모 서비스를 구측하는 경우 롤링 업데이트 보다는 블루 그린 배포 방식을 채택하는 경우가 있다.
      - 왠만하면 롤링 업데이트 배포 방식으로 유지해도 서비스를 제공하는데는 문제가 없다.

## ECS Circuit Breaker
- 비정상 서비스 배포가 발생한 경우 수동으로 개입할 필요 없이 이를 자동으로 롤백
- 실패한 배포가 발생한 경우 리소스가 실패한 작업에 낭비되거나 배포가 무기한 지연에 대한 방지책
- 배포에 대한 실패 임계치 설정과 자동 롤백 기능 제공
