## OpenSearch ë¬¸ì„œ ë”¥ë‹¤ì´ë¹™

### í…ìŠ¤íŠ¸ ë¶„ì„

ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ì„ ì‚¬ìš©í•  ë•Œ, â€œwalkâ€ë¥¼ ê²€ìƒ‰í•˜ë©´ â€œWalkâ€, â€œwalkedâ€, â€œwalkingâ€ ë“± ë‹¤ì–‘í•œ í˜•íƒœì˜ ë‹¨ì–´ê°€ í¬í•¨ëœ ê²°ê³¼ë¥¼ ëª¨ë‘ ë°›ê³  ì‹¶ì„ ê²ƒì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ OpenSearchëŠ” í…ìŠ¤íŠ¸ ë¶„ì„ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

í…ìŠ¤íŠ¸ ë¶„ì„ì˜ ëª©ì ì€ ì†ŒìŠ¤ ë¬¸ì„œì˜ ë¹„ì •í˜• ììœ  í…ìŠ¤íŠ¸ë¥¼ ì¼ë ¨ì˜ ìš©ì–´(terms)ë¡œ ë¶„í• í•˜ì—¬, ì´ë¥¼ ì—­ìƒ‰ì¸(inverted index)ì— ì €ì¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´í›„ ì‚¬ìš©ìì˜ ì¿¼ë¦¬ì—ë„ ìœ ì‚¬í•œ í…ìŠ¤íŠ¸ ë¶„ì„ì„ ì ìš©í•˜ì—¬, ìƒì„±ëœ ìš©ì–´ ì‹œí€€ìŠ¤ë¥¼ í†µí•´ ê´€ë ¨ ì†ŒìŠ¤ ë¬¸ì„œë¥¼ ë§¤ì¹­í•©ë‹ˆë‹¤.

ê¸°ìˆ ì ìœ¼ë¡œ í…ìŠ¤íŠ¸ ë¶„ì„ ê³¼ì •ì€ ì—¬ëŸ¬ ë‹¨ê³„ë¡œ ì´ë£¨ì–´ì§€ë©°, ì¼ë¶€ ë‹¨ê³„ëŠ” ì„ íƒì ì…ë‹ˆë‹¤.
1. ììœ  í…ìŠ¤íŠ¸ë¥¼ ê°œë³„ ë‹¨ì–´ë¡œ ë¶„í• í•˜ê¸° ì „ì—, ë¬¸ì ìˆ˜ì¤€ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ë‹¤ë“¬ëŠ” ê²ƒì´ ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë‹¨ê³„ì˜ ì£¼ìš” ëª©ì ì€ í† í¬ë‚˜ì´ì €(tokenizer)ê°€ ë” ë‚˜ì€ í† í°ì„ ìƒì„±í•˜ë„ë¡ ë•ëŠ” ê²ƒì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë§ˆí¬ì—… íƒœê·¸(HTML) ì œê±°, íŠ¹ì • ë¬¸ì íŒ¨í„´ ì²˜ë¦¬(ğŸ™‚ ì´ëª¨ì§€ë¥¼ â€â :slightly_smiling_face:â ë¡œ ë³€í™˜) ë“±ì´ ìˆìŠµë‹ˆë‹¤.
2. ë‹¤ìŒ ë‹¨ê³„ëŠ” ììœ  í…ìŠ¤íŠ¸ë¥¼ ê°œë³„ ë‹¨ì–´(í† í°)ë¡œ ë¶„í• í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ëŠ” í† í¬ë‚˜ì´ì €ê°€ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, â€â Actions speak louder than wordsâ ë¼ëŠ” ë¬¸ì¥ì€ â€â Actionsâ , â€â speakâ , â€â louderâ , â€â thanâ , â€â wordsâ ë¼ëŠ” í† í°ìœ¼ë¡œ ë¶„í• ë©ë‹ˆë‹¤.
3. ë§ˆì§€ë§‰ ë‹¨ê³„ëŠ” ê°œë³„ í† í°ì„ ì¼ë ¨ì˜ í† í° í•„í„°(token filter)ë¥¼ í†µí•´ ì²˜ë¦¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ê° í† í°ì„ ì˜ˆì¸¡ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜í•˜ì—¬ ì¸ë±ìŠ¤ì— ì§ì ‘ ì €ì¥í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ëŒ€ë¬¸ìë¥¼ ì†Œë¬¸ìë¡œ ë³€í™˜í•˜ê±°ë‚˜, ì–´ê°„ ì¶”ì¶œ(stemming)ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. â€â Actionsâ ëŠ” â€â actionâ , â€â louderâ ëŠ” â€â loudâ , â€â wordsâ ëŠ” â€â wordâ ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

> **í† í°(token)**ê³¼ **ìš©ì–´(term)**ëŠ” ë¹„ìŠ·í•˜ê²Œ ë“¤ë¦´ ìˆ˜ ìˆì§€ë§Œ, Apache Luceneì—ì„œëŠ” ê°ê°ì˜ ì—­í• ì´ ë‹¤ë¦…ë‹ˆë‹¤. í† í°ì€ í…ìŠ¤íŠ¸ ë¶„ì„ ì¤‘ í† í¬ë‚˜ì´ì €ì— ì˜í•´ ìƒì„±ë˜ë©°, ì¶”ê°€ì ì¸ ìˆ˜ì • ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤. ê° í† í°ì€ ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ë¶„ì„ ê³¼ì •ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤. ìš©ì–´ëŠ” ì—­ìƒ‰ì¸ì— ì§ì ‘ ì €ì¥ë˜ëŠ” ë°ì´í„° ê°’ìœ¼ë¡œ, ë©”íƒ€ë°ì´í„°ê°€ í›¨ì”¬ ì ìŠµë‹ˆë‹¤. ê²€ìƒ‰ ì‹œì—ëŠ” ìš©ì–´ ë‹¨ìœ„ë¡œ ë§¤ì¹­ì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.


#### ë¶„ì„ê¸°(Analyzer)

OpenSearchì—ì„œ í…ìŠ¤íŠ¸ ë¶„ì„ì„ í¬ê´„í•˜ëŠ” ì¶”ìƒí™” ê°œë…ì€ **ë¶„ì„ê¸°(analyzer)**ì…ë‹ˆë‹¤. ê° ë¶„ì„ê¸°ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì°¨ì  êµ¬ì„± ìš”ì†Œë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
1. ë¬¸ì í•„í„°(Character filter): ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë¬¸ì ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ë°›ì•„ ë¬¸ì ì¶”ê°€, ì œê±°, ìˆ˜ì • ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, HTML íƒœê·¸ë¥¼ ì œê±°í•˜ì—¬ `<p><b>Actions</b> speak louder than <em>words</em></p>`ì„ `\nActions speak louder than words\n`ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
2. í† í¬ë‚˜ì´ì €(Tokenizer): ë¬¸ì í•„í„°ë¡œ ì²˜ë¦¬ëœ ë¬¸ì ìŠ¤íŠ¸ë¦¼ì„ ë°›ì•„ ê°œë³„ í† í°(ë³´í†µ ë‹¨ì–´)ìœ¼ë¡œ ë¶„í• í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ê³µë°± ê¸°ì¤€ìœ¼ë¡œ ë¶„í• í•˜ì—¬ [â€`Actions`, â€`speak`, â€`louder`, â€`than`, â€`words`]ì™€ ê°™ì´ ë§Œë“­ë‹ˆë‹¤. í† í¬ë‚˜ì´ì €ëŠ” í† í°ì˜ ì‹œì‘/ë ìœ„ì¹˜ ë“± ë©”íƒ€ë°ì´í„°ë„ ìœ ì§€í•©ë‹ˆë‹¤.
3. í† í° í•„í„°(Token filter): í† í¬ë‚˜ì´ì €ì—ì„œ ìƒì„±ëœ í† í° ìŠ¤íŠ¸ë¦¼ì„ ë°›ì•„ í† í°ì„ ì¶”ê°€, ì œê±°, ìˆ˜ì •í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í† í°ì„ ì†Œë¬¸ìë¡œ ë³€í™˜(â€â Actionsâ  â†’ â€â actionâ ), ë¶ˆìš©ì–´(stopword) ì œê±°(â€â thanâ ), ë™ì˜ì–´ ì¶”ê°€(â€â speakâ  â†’ â€â talkâ ) ë“±ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

ë¶„ì„ê¸°ëŠ” ë°˜ë“œì‹œ í•˜ë‚˜ì˜ í† í¬ë‚˜ì´ì €ë¥¼ í¬í•¨í•´ì•¼ í•˜ë©°, ë¬¸ì í•„í„°ì™€ í† í° í•„í„°ëŠ” 0ê°œ ì´ìƒ í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
**ì •ê·œí™”ê¸°(normalizer)**ë¼ëŠ” íŠ¹ë³„í•œ ìœ í˜•ì˜ ë¶„ì„ê¸°ë„ ìˆìŠµë‹ˆë‹¤. ì •ê·œí™”ê¸°ëŠ” í† í¬ë‚˜ì´ì €ë¥¼ í¬í•¨í•˜ì§€ ì•Šìœ¼ë©°, íŠ¹ì • ë¬¸ì í•„í„°ì™€ í† í° í•„í„°ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í•„í„°ë“¤ì€ ë¬¸ì ìˆ˜ì¤€ì˜ ì‘ì—…ë§Œ ìˆ˜í–‰í•˜ë©°, í† í° ì „ì²´ì— ëŒ€í•œ ì‘ì—…(ë™ì˜ì–´ ì²˜ë¦¬, ì–´ê°„ ì¶”ì¶œ ë“±)ì€ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.


#### ë‚´ì¥ ë¶„ì„ê¸°(Built-in Analyzers)

OpenSearchëŠ” ë‹¤ì–‘í•œ ë‚´ì¥ ë¶„ì„ê¸°ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë³„ë„ì˜ ì„¤ì • ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| ë¶„ì„ê¸° | ì„¤ëª… | ì˜ˆì‹œ (`"Actions speak louder than words"`) |
|---|---|---|
| **Standard** | ê¸°ë³¸ ë¶„ì„ê¸°. ìœ ë‹ˆì½”ë“œ í…ìŠ¤íŠ¸ ë¶„í• , ì†Œë¬¸ì ë³€í™˜, ë¶ˆìš©ì–´ ì œê±°(ì„ íƒ). ëŒ€ë¶€ë¶„ì˜ ì–¸ì–´ì— ì í•© | [`actions`, `speak`, `louder`, `than`, `words`] |
| **Simple** | ë¬¸ìê°€ ì•„ë‹Œ ê³³ì—ì„œ ë¶„í• í•˜ê³  ì†Œë¬¸ìë¡œ ë³€í™˜. ìˆ«ìëŠ” ì œê±°ë¨ | [`actions`, `speak`, `louder`, `than`, `words`] |
| **Whitespace** | ê³µë°± ê¸°ì¤€ìœ¼ë¡œë§Œ ë¶„í• . ëŒ€ì†Œë¬¸ì ë³€í™˜ ì—†ìŒ | [`Actions`, `speak`, `louder`, `than`, `words`] |
| **Stop** | Simple ë¶„ì„ê¸°ì™€ ë™ì¼í•˜ì§€ë§Œ ë¶ˆìš©ì–´(the, a, is ë“±)ë¥¼ ì œê±° | [`actions`, `speak`, `louder`, `words`] |
| **Keyword** | í…ìŠ¤íŠ¸ë¥¼ ë¶„í• í•˜ì§€ ì•Šê³  ì „ì²´ë¥¼ í•˜ë‚˜ì˜ í† í°ìœ¼ë¡œ ì·¨ê¸‰ | [`Actions speak louder than words`] |
| **Pattern** | ì •ê·œ í‘œí˜„ì‹ íŒ¨í„´ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„í• . ê¸°ë³¸ íŒ¨í„´ì€ `\W+`(ë¹„ ë‹¨ì–´ ë¬¸ì) | [`actions`, `speak`, `louder`, `than`, `words`] |
| **Language** | íŠ¹ì • ì–¸ì–´ì— ìµœì í™”ëœ ë¶„ì„ê¸° (english, french, german ë“±) | [`action`, `speak`, `louder`, `word`] (english) |

> **í•œêµ­ì–´ ë¶„ì„ê¸° - Nori**
> OpenSearchëŠ” í•œêµ­ì–´ í˜•íƒœì†Œ ë¶„ì„ì„ ìœ„í•œ **Nori ë¶„ì„ê¸°**ë¥¼ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì œê³µí•©ë‹ˆë‹¤. NoriëŠ” í•œêµ­ì–´ í…ìŠ¤íŠ¸ë¥¼ í˜•íƒœì†Œ ë‹¨ìœ„ë¡œ ë¶„í• í•˜ë©°, ë³µí•©ëª…ì‚¬ ë¶„í•´, í’ˆì‚¬ í•„í„°ë§ ë“±ì„ ì§€ì›í•©ë‹ˆë‹¤.
> ì˜ˆë¥¼ ë“¤ì–´, `"ì‚¼ì„±ì „ìê°€ ìƒˆë¡œìš´ ìŠ¤ë§ˆíŠ¸í°ì„ ì¶œì‹œí–ˆë‹¤"`ë¥¼ ë¶„ì„í•˜ë©´ `[ì‚¼ì„±, ì „ì, ê°€, ìƒˆë¡­, ìŠ¤ë§ˆíŠ¸í°, ì„, ì¶œì‹œ, í•˜]`ì™€ ê°™ì´ í˜•íƒœì†Œ ë‹¨ìœ„ë¡œ ë¶„í• ë©ë‹ˆë‹¤.
>
> ```json
> PUT /korean-index
> {
>   "settings": {
>     "analysis": {
>       "analyzer": {
>         "korean_analyzer": {
>           "type": "custom",
>           "tokenizer": "nori_tokenizer",
>           "filter": ["nori_part_of_speech"]
>         }
>       }
>     }
>   }
> }
> ```


#### ì»¤ìŠ¤í…€ ë¶„ì„ê¸°(Custom Analyzer)

ë‚´ì¥ ë¶„ì„ê¸°ê°€ ìš”êµ¬ ì‚¬í•­ì— ë§ì§€ ì•Šì„ ê²½ìš°, ë¬¸ì í•„í„°, í† í¬ë‚˜ì´ì €, í† í° í•„í„°ë¥¼ ì§ì ‘ ì¡°í•©í•˜ì—¬ ì»¤ìŠ¤í…€ ë¶„ì„ê¸°ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json
PUT /my-index
{
  "settings": {
    "analysis": {
      "char_filter": {
        "my_char_filter": {
          "type": "html_strip"
        }
      },
      "tokenizer": {
        "my_tokenizer": {
          "type": "standard"
        }
      },
      "filter": {
        "my_stop_filter": {
          "type": "stop",
          "stopwords": ["the", "a", "is", "in"]
        }
      },
      "analyzer": {
        "my_custom_analyzer": {
          "type": "custom",
          "char_filter": ["my_char_filter"],
          "tokenizer": "my_tokenizer",
          "filter": ["lowercase", "my_stop_filter"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "content": {
        "type": "text",
        "analyzer": "my_custom_analyzer"
      }
    }
  }
}
```


#### _analyze API

ë¶„ì„ê¸°ê°€ í…ìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ `_analyze` APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶„ì„ê¸° ì„¤ì •ì„ ë””ë²„ê¹…í•˜ê±°ë‚˜ ê¸°ëŒ€í•œ ëŒ€ë¡œ í† í°ì´ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

```bash
## ë‚´ì¥ ë¶„ì„ê¸°ë¡œ í…ìŠ¤íŠ¸ ë¶„ì„ í…ŒìŠ¤íŠ¸
POST _analyze
{
  "analyzer": "standard",
  "text": "Actions speak louder than words"
}

## íŠ¹ì • ì¸ë±ìŠ¤ì— ì„¤ì •ëœ ë¶„ì„ê¸°ë¡œ í…ŒìŠ¤íŠ¸
POST /my-index/_analyze
{
  "analyzer": "my_custom_analyzer",
  "text": "Actions speak louder than words"
}

## í† í¬ë‚˜ì´ì €ì™€ í•„í„°ë¥¼ ì§ì ‘ ì§€ì •í•˜ì—¬ í…ŒìŠ¤íŠ¸
POST _analyze
{
  "tokenizer": "standard",
  "filter": ["lowercase", "stop"],
  "text": "Actions speak louder than words"
}
```

ì‘ë‹µ ì˜ˆì‹œ:
```json
{
  "tokens": [
    { "token": "actions", "start_offset": 0, "end_offset": 7, "type": "<ALPHANUM>", "position": 0 },
    { "token": "speak",   "start_offset": 8, "end_offset": 13, "type": "<ALPHANUM>", "position": 1 },
    { "token": "louder",  "start_offset": 14, "end_offset": 20, "type": "<ALPHANUM>", "position": 2 },
    { "token": "than",    "start_offset": 21, "end_offset": 25, "type": "<ALPHANUM>", "position": 3 },
    { "token": "words",   "start_offset": 26, "end_offset": 31, "type": "<ALPHANUM>", "position": 4 }
  ]
}
```


#### ì¸ë±ì‹± ì‹œì ê³¼ ì¿¼ë¦¬ ì‹œì ì˜ í…ìŠ¤íŠ¸ ë¶„ì„

OpenSearchëŠ” ë¬¸ì„œë¥¼ ì¸ë±ì‹±í•  ë•Œì™€ ê²€ìƒ‰ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ í…ìŠ¤íŠ¸ í•„ë“œì— ëŒ€í•´ í…ìŠ¤íŠ¸ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë¶„ì„ ì‹œì ì— ë”°ë¼ ë¶„ì„ê¸°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë¶„ë¥˜ë©ë‹ˆë‹¤.
- **ì¸ë±ìŠ¤ ë¶„ì„ê¸°(index analyzer)**: ì¸ë±ì‹± ì‹œì ì— í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.
- **ê²€ìƒ‰ ë¶„ì„ê¸°(search analyzer)**: ì¿¼ë¦¬ ì‹œì ì— ì¿¼ë¦¬ ë¬¸ìì—´ì„ ë¶„ì„í•©ë‹ˆë‹¤.

ë¶„ì„ê¸°ëŠ” ë‹¤ìŒ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ê²°ì •ë©ë‹ˆë‹¤.

**ì¸ë±ìŠ¤ ë¶„ì„ê¸° ìš°ì„ ìˆœìœ„:**
1. ë§¤í•‘ì—ì„œ í•„ë“œì— ì§€ì •ëœ `analyzer`
2. ì¸ë±ìŠ¤ ì„¤ì •ì˜ `analysis.analyzer.default`
3. Standard ë¶„ì„ê¸° (ê¸°ë³¸ê°’)

**ê²€ìƒ‰ ë¶„ì„ê¸° ìš°ì„ ìˆœìœ„:**
1. ì¿¼ë¦¬ì—ì„œ ì§€ì •ëœ `analyzer` íŒŒë¼ë¯¸í„°
2. ë§¤í•‘ì—ì„œ í•„ë“œì— ì§€ì •ëœ `search_analyzer`
3. ì¸ë±ìŠ¤ ì„¤ì •ì˜ `analysis.analyzer.default_search`
4. ë§¤í•‘ì—ì„œ í•„ë“œì— ì§€ì •ëœ `analyzer`
5. Standard ë¶„ì„ê¸° (ê¸°ë³¸ê°’)

```json
PUT /my-index
{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "standard",
        "search_analyzer": "simple"
      }
    }
  }
}
```

ëŒ€ë¶€ë¶„ì˜ ê²½ìš°, ì¸ë±ì‹±ê³¼ ê²€ìƒ‰ ì‹œì ì— ë™ì¼í•œ ë¶„ì„ê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ê·¸ë˜ì•¼ í…ìŠ¤íŠ¸ í•„ë“œì™€ ì¿¼ë¦¬ ë¬¸ìì—´ì´ ë™ì¼í•˜ê²Œ ë¶„ì„ë˜ì–´ í† í°ì´ ì¼ì¹˜í•©ë‹ˆë‹¤.

> **ì˜ˆì™¸: ë™ì˜ì–´(synonym) ì²˜ë¦¬**
> ë™ì˜ì–´ í•„í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” ì¸ë±ìŠ¤ ë¶„ì„ê¸°ì™€ ê²€ìƒ‰ ë¶„ì„ê¸°ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¸ë±ì‹± ì‹œì ì— ë™ì˜ì–´ë¥¼ í™•ì¥í•˜ë©´ ì¸ë±ìŠ¤ í¬ê¸°ê°€ ì»¤ì§€ì§€ë§Œ ê²€ìƒ‰ì´ ë¹ ë¦…ë‹ˆë‹¤. ë°˜ë©´, ê²€ìƒ‰ ì‹œì ì—ë§Œ ë™ì˜ì–´ë¥¼ ì ìš©í•˜ë©´ ì¸ë±ìŠ¤ í¬ê¸°ëŠ” ì‘ì§€ë§Œ ê²€ìƒ‰ ì‹œ ì¶”ê°€ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. ë™ì˜ì–´ ëª©ë¡ì´ ìì£¼ ë³€ê²½ë˜ëŠ” ê²½ìš°, ê²€ìƒ‰ ì‹œì ì—ë§Œ ë™ì˜ì–´ë¥¼ ì ìš©í•˜ë©´ ì¸ë±ìŠ¤ë¥¼ ë‹¤ì‹œ ìƒì„±í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤.

##### ì˜ˆì‹œ

`Actions speak louder than words`ë¼ëŠ” í…ìŠ¤íŠ¸ í•„ë“œë¥¼ ì¸ë±ì‹±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í† í°ì´ ìƒì„±ë©ë‹ˆë‹¤:

í…ìŠ¤íŠ¸ í•„ë“œ í† í° = [â€`action`, â€`speak`, â€`loud`, â€`than`, â€`word`]

`speaking loudly`ë¼ëŠ” ì¿¼ë¦¬ë¡œ ê²€ìƒ‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í† í°ì´ ìƒì„±ë©ë‹ˆë‹¤:

ì¿¼ë¦¬ ë¬¸ìì—´ í† í° = [â€`speak`, â€`loud`]

OpenSearchëŠ” ì¿¼ë¦¬ í† í°ê³¼ í…ìŠ¤íŠ¸ í•„ë“œ í† í°ì„ ë¹„êµí•˜ì—¬, ë‘ ë¦¬ìŠ¤íŠ¸ ëª¨ë‘ì— `speak`ì™€ `loud`ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ë¬¸ì„œë¥¼ ê²€ìƒ‰ ê²°ê³¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.


### OpenSearch Refresh Interval

OpenSearchì—ì„œ ë¬¸ì„œë¥¼ ì¸ë±ì‹±í•˜ë©´, ë¬¸ì„œëŠ” ì²˜ìŒì— ë©”ëª¨ë¦¬ ë²„í¼ì— ì €ì¥ë©ë‹ˆë‹¤.   
ì´ ë‹¨ê³„ì—ì„œëŠ” ë¬¸ì„œê°€ ì•„ì§ ê²€ìƒ‰ ê°€ëŠ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.     
ë¬¸ì„œë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ë ¤ë©´ refresh ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.  
ì´ ì‘ì—…ì€ ë¬¸ì„œë¥¼ ë©”ëª¨ë¦¬ ë²„í¼ì—ì„œ ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì˜®ê¹ë‹ˆë‹¤.     
ì„¸ê·¸ë¨¼íŠ¸ëŠ” OpenSearchê°€ ë¬¸ì„œë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° êµ¬ì¡°ì…ë‹ˆë‹¤.
ë¬¸ì„œê°€ ì„¸ê·¸ë¨¼íŠ¸ì— ì €ì¥ë˜ë©´ ê²€ìƒ‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.   
> **Segmentë€ ë¬´ì—‡ì¸ê°€?**
>
> OpenSearchì—ì„œ Segment(ì„¸ê·¸ë¨¼íŠ¸)ëŠ” Lucene ì—”ì§„ì´ ì¸ë±ìŠ¤ ìƒ¤ë“œ ë‚´ì— ìƒì„±í•˜ëŠ” ë¶ˆë³€(immutable) ë°ì´í„° íŒŒì¼ì…ë‹ˆë‹¤.
> ë¬¸ì„œê°€ ì¸ë±ì‹±ë  ë•Œ, ì´ë“¤ì€ ë©”ëª¨ë¦¬ ë²„í¼ì— ì €ì¥ë˜ê³ , refresh ì‘ì—…ì´ ë°œìƒí•˜ë©´ ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë³€í™˜ë˜ì–´ ë””ìŠ¤í¬ì— ê¸°ë¡ë©ë‹ˆë‹¤.
> ì„¸ê·¸ë¨¼íŠ¸ëŠ” ê²€ìƒ‰ ì‹œ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì½ê³  ì²˜ë¦¬í•˜ëŠ” ë‹¨ìœ„ì´ê¸°ë„ í•©ë‹ˆë‹¤.
> ì„¸ê·¸ë¨¼íŠ¸ëŠ” í•œ ë²ˆ ìƒì„±ë˜ë©´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©°, ìƒˆë¡œìš´ ë¬¸ì„œê°€ ì¶”ê°€ë˜ê±°ë‚˜ ì‚­ì œë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.
> ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ì—¬ëŸ¬ ì„¸ê·¸ë¨¼íŠ¸ê°€ ë³‘í•©(merge)ë˜ì–´ ë” í° ì„¸ê·¸ë¨¼íŠ¸ë¡œ í•©ì³ì§‘ë‹ˆë‹¤. ì½ê¸° ì „ìš© ì¸ë±ìŠ¤ì˜ ê²½ìš°, `force merge` APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì„¸ê·¸ë¨¼íŠ¸ ìˆ˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¤„ì—¬ ê²€ìƒ‰ ì„±ëŠ¥ì„ ìµœì í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>
> ```bash
> POST /my-index/_forcemerge?max_num_segments=1
> ```

refresh ì‘ì—…ì€ ë¬¸ì„œë¥¼ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì˜®ê²¨ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” ê³¼ì •ì´ë©°, OpenSearchê°€ ìë™ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.   
ê¸°ë³¸ì ìœ¼ë¡œ OpenSearchëŠ” ì§€ë‚œ 30ì´ˆ ë™ì•ˆ í•˜ë‚˜ ì´ìƒì˜ ê²€ìƒ‰ ìš”ì²­ì„ ë°›ì€ ì¸ë±ìŠ¤ì— ëŒ€í•´ 1ì´ˆë§ˆë‹¤ refreshë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.    
ì¦‰, í™œì„± ì¸ë±ìŠ¤ì— ê¸°ë¡ëœ ë¬¸ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ 1ì´ˆ ì´ë‚´ì— ê²€ìƒ‰ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤. ì¸ë±ìŠ¤ì˜ ê¸°ë³¸ refresh ë¹ˆë„ëŠ” 1ì´ˆë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, ì¸ë±ìŠ¤ë³„ë¡œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  


refresh ì‘ì—…ì€ ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì†Œëª¨í•©ë‹ˆë‹¤.   
ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì˜®ê¸°ê³  ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“œëŠ” ê³¼ì •ì€ CPU, ë©”ëª¨ë¦¬, I/O ë¦¬ì†ŒìŠ¤ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.  
ë”°ë¼ì„œ refresh ì‘ì—…ì„ ì¤„ì´ë©´ ì´ëŸ¬í•œ ë¦¬ì†ŒìŠ¤ë¥¼ ë‹¤ë¥¸ ì‘ì—…ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ refresh ë¹ˆë„ë¥¼ ë‚®ì¶”ë©´ ìƒˆë¡œ ì¸ë±ì‹±ëœ ë¬¸ì„œê°€ ê²€ìƒ‰ ê°€ëŠ¥í•´ì§€ê¸°ê¹Œì§€ ë” ì˜¤ë˜ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.    
ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê±°ì˜ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²€ìƒ‰í•´ì•¼ í•˜ëŠ” ê²½ìš°, refresh ë¹ˆë„ë¥¼ ë‚®ì¶”ëŠ” ê²ƒì€ ì í•©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.     
ë°˜ë©´, ë°ì´í„° ì¸ë±ì‹±ê³¼ ê²€ìƒ‰ ì‚¬ì´ì— ì§€ì—°ì„ í—ˆìš©í•  ìˆ˜ ìˆë‹¤ë©´ refresh ë¹ˆë„ë¥¼ ì¤„ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì¸ë±ì‹± ì²˜ë¦¬ëŸ‰ ì¦ê°€ì™€ ë” ë¹ ë¥¸ ì¸ë±ì‹± ì†ë„ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Refresh Interval ì„¤ì •

```bash
## íŠ¹ì • ì¸ë±ìŠ¤ì˜ refresh intervalì„ 30ì´ˆë¡œ ë³€ê²½
PUT /my-index/_settings
{
  "index": {
    "refresh_interval": "30s"
  }
}

## ëŒ€ëŸ‰ ì¸ë±ì‹± ì‹œ refreshë¥¼ ë¹„í™œì„±í™”í•˜ì—¬ ì„±ëŠ¥ ê·¹ëŒ€í™”
PUT /my-index/_settings
{
  "index": {
    "refresh_interval": "-1"
  }
}

## ëŒ€ëŸ‰ ì¸ë±ì‹± ì™„ë£Œ í›„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µì›
PUT /my-index/_settings
{
  "index": {
    "refresh_interval": "1s"
  }
}
```

ë¬¸ì„œë¥¼ ì¸ë±ì‹±í•  ë•Œ `refresh` ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ë¬¸ì„œì˜ ê²€ìƒ‰ ê°€ëŠ¥ ì‹œì ì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| íŒŒë¼ë¯¸í„° | ë™ì‘ |
|---|---|
| `?refresh=false` | ê¸°ë³¸ê°’. refreshë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠìŒ. ë‹¤ìŒ ì£¼ê¸°ì  refresh ì‹œ ê²€ìƒ‰ ê°€ëŠ¥ |
| `?refresh=true` | ì¦‰ì‹œ refreshë¥¼ ìˆ˜í–‰í•˜ì—¬ ë¬¸ì„œë¥¼ ë°”ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ í•¨. ë¹ˆë²ˆí•˜ê²Œ ì‚¬ìš©í•˜ë©´ ì„±ëŠ¥ ì €í•˜ ìœ ë°œ |
| `?refresh=wait_for` | ë‹¤ìŒ ì£¼ê¸°ì  refreshê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ìš”ì²­ì„ ëŒ€ê¸°. `true`ë³´ë‹¤ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì  |


#### Refresh vs Flush

Refreshì™€ FlushëŠ” ìì£¼ í˜¼ë™ë˜ì§€ë§Œ, ì„œë¡œ ë‹¤ë¥¸ ëª©ì ì„ ê°€ì§„ ë³„ê°œì˜ ì‘ì—…ì…ë‹ˆë‹¤.

| êµ¬ë¶„ | Refresh | Flush |
|---|---|---|
| **ëª©ì ** | ë¬¸ì„œë¥¼ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦ | ë°ì´í„°ì˜ ë‚´êµ¬ì„±(durability)ì„ ë³´ì¥ |
| **ë™ì‘** | ë©”ëª¨ë¦¬ ë²„í¼ â†’ ìƒˆë¡œìš´ ì„¸ê·¸ë¨¼íŠ¸(ê²€ìƒ‰ ê°€ëŠ¥) | translog â†’ ë””ìŠ¤í¬ì— Lucene ì»¤ë°‹ ìˆ˜í–‰ |
| **ê¸°ë³¸ ì£¼ê¸°** | 1ì´ˆ (í™œì„± ì¸ë±ìŠ¤) | ìë™ ê´€ë¦¬ (translog í¬ê¸° ê¸°ë°˜) |
| **ë°ì´í„° ì†ì‹¤** | ì„¸ê·¸ë¨¼íŠ¸ê°€ ì•„ì§ ë””ìŠ¤í¬ì— ì»¤ë°‹ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ | ì»¤ë°‹ ì™„ë£Œ í›„ ë°ì´í„° ì†ì‹¤ ì—†ìŒ |

ì¦‰, **RefreshëŠ” "ê²€ìƒ‰ ê°€ëŠ¥ì„±"**, **FlushëŠ” "ë°ì´í„° ì˜ì†ì„±"**ì— ê´€í•œ ì‘ì—…ì…ë‹ˆë‹¤. Refresh í›„ì—ë„ ë°ì´í„°ê°€ ì•„ì§ translogì—ë§Œ ì¡´ì¬í•  ìˆ˜ ìˆìœ¼ë©°, Flushê°€ ìˆ˜í–‰ë˜ì–´ì•¼ ë¹„ë¡œì†Œ ë””ìŠ¤í¬ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤. ë…¸ë“œ ì¥ì•  ë°œìƒ ì‹œ translogë¥¼ í†µí•´ ë§ˆì§€ë§‰ Flush ì´í›„ì˜ ë°ì´í„°ë¥¼ ë³µêµ¬í•©ë‹ˆë‹¤.


### OpenSearch DSL ëª¨ìŒì§‘

```bash
## í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
GET _cluster/health

## ìƒì„±ëœ indexê°€ ìˆëŠ”ì§€ í™•ì¸
GET _cat/indices?v

## ì„¤ì¹˜ëœ í”ŒëŸ¬ê·¸ì¸ì´ ìˆëŠ”ì§€ í™•ì¸
GET _cat/plugins?v

## íŠ¹ì • ì¸ë±ìŠ¤ì˜ ë§¤í•‘ ì •ë³´ í™•ì¸
GET /my-index/_mapping

## íŠ¹ì • ì¸ë±ìŠ¤ì˜ ì„¤ì • í™•ì¸
GET /my-index/_settings
```

#### ì¸ë±ìŠ¤ ìƒì„± ë° ê´€ë¦¬

```bash
## ì¸ë±ìŠ¤ ìƒì„± (ë§¤í•‘ í¬í•¨)
PUT /my-index
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "title": { "type": "text" },
      "content": { "type": "text" },
      "created_at": { "type": "date" },
      "views": { "type": "integer" },
      "tags": { "type": "keyword" }
    }
  }
}

## ì¸ë±ìŠ¤ ì‚­ì œ
DELETE /my-index
```

#### ë¬¸ì„œ CRUD

```bash
## ë¬¸ì„œ ìƒì„± (ID ì§€ì •)
PUT /my-index/_doc/1
{
  "title": "OpenSearch ì‹œì‘í•˜ê¸°",
  "content": "OpenSearchëŠ” ì˜¤í”ˆì†ŒìŠ¤ ê²€ìƒ‰ ì—”ì§„ì…ë‹ˆë‹¤.",
  "created_at": "2024-01-01",
  "views": 100,
  "tags": ["search", "opensearch"]
}

## ë¬¸ì„œ ìƒì„± (ID ìë™ ìƒì„±)
POST /my-index/_doc
{
  "title": "Elasticsearch vs OpenSearch",
  "content": "ë‘ ê²€ìƒ‰ ì—”ì§„ì˜ ì°¨ì´ì ì„ ì•Œì•„ë´…ë‹ˆë‹¤."
}

## ë¬¸ì„œ ì¡°íšŒ
GET /my-index/_doc/1

## ë¬¸ì„œ ë¶€ë¶„ ìˆ˜ì •
POST /my-index/_update/1
{
  "doc": {
    "views": 150
  }
}

## ë¬¸ì„œ ì‚­ì œ
DELETE /my-index/_doc/1
```

#### ê²€ìƒ‰ ì¿¼ë¦¬

```bash
## match ì¿¼ë¦¬ (ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰)
GET /my-index/_search
{
  "query": {
    "match": {
      "content": "ì˜¤í”ˆì†ŒìŠ¤ ê²€ìƒ‰"
    }
  }
}

## multi_match ì¿¼ë¦¬ (ì—¬ëŸ¬ í•„ë“œì—ì„œ ê²€ìƒ‰)
GET /my-index/_search
{
  "query": {
    "multi_match": {
      "query": "OpenSearch ì‹œì‘",
      "fields": ["title^2", "content"]
    }
  }
}

## bool ì¿¼ë¦¬ (ë³µí•© ì¡°ê±´)
GET /my-index/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "content": "ê²€ìƒ‰ ì—”ì§„" } }
      ],
      "filter": [
        { "term": { "tags": "opensearch" } },
        { "range": { "views": { "gte": 50 } } }
      ],
      "should": [
        { "match": { "title": "ì‹œì‘í•˜ê¸°" } }
      ]
    }
  }
}

## term ì¿¼ë¦¬ (ì •í™•í•œ ê°’ ë§¤ì¹­, keyword í•„ë“œì— ì‚¬ìš©)
GET /my-index/_search
{
  "query": {
    "term": {
      "tags": "opensearch"
    }
  }
}

## í˜ì´ì§•ê³¼ ì •ë ¬
GET /my-index/_search
{
  "from": 0,
  "size": 10,
  "sort": [
    { "created_at": { "order": "desc" } },
    "_score"
  ],
  "query": {
    "match_all": {}
  }
}
```

#### ì§‘ê³„(Aggregation)

```bash
## íƒœê·¸ë³„ ë¬¸ì„œ ìˆ˜ ì§‘ê³„
GET /my-index/_search
{
  "size": 0,
  "aggs": {
    "tag_count": {
      "terms": {
        "field": "tags",
        "size": 10
      }
    }
  }
}

## í‰ê·  ì¡°íšŒìˆ˜ ì§‘ê³„
GET /my-index/_search
{
  "size": 0,
  "aggs": {
    "avg_views": {
      "avg": {
        "field": "views"
      }
    }
  }
}
```
